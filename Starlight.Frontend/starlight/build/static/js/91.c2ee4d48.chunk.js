"use strict";(self.webpackChunkstarlight=self.webpackChunkstarlight||[]).push([[91],{2472:(e,s,a)=>{a.r(s),a.d(s,{default:()=>C});var n=a(5043),t=a(6213),i=(a(4166),a(3216)),l=a(5475),r=a(8397),c=a(7653),o=a(4320),d=a(6494),h=a(9883),m=a(653),u=a(1832),x=a(8440),g=a(972),j=a(5164),v=a(4797),p=a(9895),y=a(3900),b=a(3204),N=a(579);const f=(0,n.lazy)((()=>Promise.all([a.e(4339),a.e(5508)]).then(a.bind(a,2100)))),k=(0,n.lazy)((()=>Promise.all([a.e(2396),a.e(6253)]).then(a.bind(a,5203)))),S=(0,n.lazy)((()=>a.e(20).then(a.bind(a,7639)))),w=(0,n.lazy)((()=>a.e(2309).then(a.bind(a,4690)))),E=(0,n.lazy)((()=>Promise.all([a.e(4339),a.e(2396),a.e(5508),a.e(6353),a.e(6253)]).then(a.bind(a,6353)))),L=(0,n.lazy)((()=>Promise.all([a.e(1289),a.e(8096)]).then(a.bind(a,8096)))),P="https://cluster1.swyrin.id.vn";const C=function e(){const[s,a]=(0,n.useState)(!1),[C,q]=(0,n.useState)({}),[I,T]=(0,n.useState)([]),[U,A]=(0,n.useState)(0),[$,G]=(0,n.useState)(!1),[z,H]=(0,n.useState)(!1),[_,O]=(0,n.useState)(),[B,D]=(0,n.useState)(),[F,K]=(0,n.useState)(""),M=new y.A(I,{keys:["title"],threshold:.3}),R=F?M.search(F).map((e=>e.item)):I,{unityProvider:V,sendMessage:Y,addEventListener:Z,removeEventListener:J}=(0,r.sT)({loaderUrl:"build/myunityapp.loader.js",dataUrl:"build/myunityapp.data",frameworkUrl:"build/myunityapp.framework.js",codeUrl:"build/myunityapp.wasm"}),Q=(0,i.Zp)(),W=(0,n.useCallback)(((e,s)=>{H(!0),O(e),D(s)}),[]);(0,n.useEffect)((()=>(Z("GameOver",W),()=>{J("GameOver",W)})),[Z,J,W]),(0,n.useEffect)((()=>{(async()=>{try{const e=await t.A.get(`${P}/api/user`,{headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===e.status){const s=e.data;q({id:s.id||123456,name:s.name||"Sanraku",profilePic:s.avatar||c})}else console.error("Error fetching user data:",e.statusText);const s=await t.A.get(`${P}/api/track/all`,{headers:{"Content-Type":"application/json"}});if(200===s.status){const e=s.data;T(e),e.length>0&&A(0)}else console.error("Error fetching songs data:",s.statusText)}catch(e){console.error("Error fetching data:",e)}})()}),[]);const X=(0,n.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{A((e=>(e+1)%I.length)),e.classList.remove("fade-out")}),{once:!0}))}),[I]),ee=(0,n.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{A((e=>(e-1+I.length)%I.length)),e.classList.remove("fade-out")}),{once:!0}))}),[I]),se=()=>{G(!0)},ae=I[U];(0,n.useEffect)((()=>{let e;return ae&&ae.audioUrl&&(e=new Audio(ae.audioUrl),e.loop=!0,e.play().catch((e=>console.error("Error playing audio:",e)))),()=>{e&&(e.pause(),e=null)}}),[ae]),(0,n.useEffect)((()=>{const e=document.querySelector(".background-image img");e&&e.addEventListener("transitionend",(()=>{e.classList.remove("morph")}))}),[ae]);const ne=e=>{const s=document.querySelector(e);s&&(s.classList.add("hover"),setTimeout((()=>{s.classList.remove("hover")}),300))};return(0,n.useEffect)((()=>{const e=e=>{39===e.keyCode?(X(),ne(".next-btn")):37===e.keyCode&&(ee(),ne(".prev-btn"))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[X,ee]),(0,n.useEffect)((()=>{const e=e=>{27===e.keyCode&&(e.preventDefault(),se())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]),(0,N.jsxs)(n.Fragment,{children:[(0,N.jsx)(n.Suspense,{fallback:(0,N.jsx)("div",{children:"Loading..."}),children:(0,N.jsxs)(i.BV,{children:[(0,N.jsx)(i.qh,{path:"/SongPage",element:(0,N.jsx)(e,{})}),(0,N.jsx)(i.qh,{path:"/HistoryPage",element:(0,N.jsx)(k,{})}),(0,N.jsx)(i.qh,{path:"/EventPage",element:(0,N.jsx)(S,{})}),(0,N.jsx)(i.qh,{path:"/StorePage",element:(0,N.jsx)(w,{})}),(0,N.jsx)(i.qh,{path:"/Logout",element:(0,N.jsx)(f,{})}),(0,N.jsx)(i.qh,{path:"/ProfilePage",element:(0,N.jsx)(E,{})}),(0,N.jsx)(i.qh,{path:"/TestGame",element:(0,N.jsx)(L,{songId:null===ae||void 0===ae?void 0:ae.id})})]})}),(0,N.jsxs)("div",{className:"songpage",children:[(0,N.jsxs)("header",{className:"navbar",children:[(0,N.jsxs)("div",{id:"nav-icon1",className:s?"open":"",onClick:()=>{a(!s)},children:[(0,N.jsx)("span",{}),(0,N.jsx)("span",{}),(0,N.jsx)("span",{})]}),(0,N.jsxs)("nav",{className:"nav-links left",children:[(0,N.jsxs)(l.N_,{to:"/SongPage",children:[(0,N.jsx)("img",{src:h,alt:"Songs",className:"nav-icon"}),(0,N.jsx)("span",{children:"Songs"})]}),(0,N.jsxs)(l.N_,{to:"/HistoryPage",state:{currentSong:ae,currentSongIndex:U},children:[(0,N.jsx)("img",{src:m,alt:"History",className:"nav-icon"}),(0,N.jsx)("span",{children:"History"})]})]}),(0,N.jsx)("div",{className:"logo-container",children:(0,N.jsx)("a",{href:"/SongPage",className:"logo",children:(0,N.jsxs)("span",{className:"star-light",children:[(0,N.jsx)("span",{children:"STAR"}),(0,N.jsx)("img",{src:o,alt:"Logo",className:"logo-icon",style:{verticalAlign:"middle"}}),(0,N.jsx)("span",{className:"light",children:"LIGHT"})]})})}),(0,N.jsxs)("nav",{className:"nav-links right",children:[(0,N.jsxs)(l.N_,{to:"/EventPage",state:{currentSong:ae,currentSongIndex:U},children:[(0,N.jsx)("img",{src:u,alt:"Events",className:"nav-icon"}),(0,N.jsx)("span",{children:"Events"})]}),(0,N.jsxs)(l.N_,{to:"/StorePage",state:{currentSong:ae,currentSongIndex:U},children:[(0,N.jsx)("img",{src:x,alt:"Store",className:"nav-icon"}),(0,N.jsx)("span",{children:"Store"})]})]}),(0,N.jsxs)("div",{className:"sidebar "+(s?"open":""),style:{backgroundImage:`url(${v})`},children:[(0,N.jsx)("div",{className:"search-bar-container",children:(0,N.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault()},children:[(0,N.jsx)("label",{htmlFor:"search",className:"screen-reader-text",children:"Search"}),(0,N.jsx)("input",{type:"search",id:"search",placeholder:"Search songs...",value:F,onChange:e=>{K(e.target.value)},className:"search-field"}),(0,N.jsx)("button",{type:"submit",className:"search-submit",children:(0,N.jsx)(b.KSO,{className:"search-bar-icon"})})]})}),(0,N.jsx)("ul",{children:R.map(((e,s)=>(0,N.jsxs)("li",{className:"song-item",onClick:()=>A(s),children:[(0,N.jsxs)("div",{className:"song-info-sidebar",children:[(0,N.jsx)("img",{src:p,alt:"Song Sidebar Icon",className:"song-sidebar-icon"}),(0,N.jsx)("span",{className:"sidebar-song",children:e.title})]}),(0,N.jsx)("div",{className:"song-bg",style:{backgroundImage:`url(${e.backgroundUrl})`}}),(0,N.jsx)("span",{className:"sidebar-song-title",children:e.title})]},s)))})]}),(0,N.jsx)("div",{className:"leave-button",children:(0,N.jsx)("img",{src:d,alt:"Leave",className:"leave-icon",style:{width:"26p</button>x",height:"26px"},onClick:se})})]}),(0,N.jsxs)("div",{className:"content-layer",children:[(0,N.jsx)("div",{className:"background-image",children:(0,N.jsx)("img",{src:ae&&ae.backgroundUrl?`${ae.backgroundUrl}`:"",alt:"Background"})}),(0,N.jsxs)("div",{className:"song-content",children:[(0,N.jsx)("div",{className:"user-profile",children:(0,N.jsx)("table",{children:(0,N.jsxs)("tr",{children:[(0,N.jsxs)("td",{children:[(0,N.jsx)("div",{className:"user-name",children:C.name}),(0,N.jsxs)("div",{className:"user-id",children:["ID: ",C.id]})]}),(0,N.jsx)("td",{children:(0,N.jsx)(l.N_,{to:"/ProfilePage",children:(0,N.jsx)("img",{src:C.profilePic||c,alt:"Profile",className:"profile-img"})})})]})})}),(0,N.jsxs)("div",{className:"song-navigation",children:[(0,N.jsx)("button",{className:"nav-btn prev-btn",onClick:ee,children:(0,N.jsx)("img",{src:g,alt:"Previous",style:{width:"21px",height:"21px"}})}),(0,N.jsx)("button",{className:"nav-btn next-btn",onClick:X,children:(0,N.jsx)("img",{src:j,alt:"Next",style:{width:"21px",height:"21px"}})})]}),(0,N.jsxs)("div",{className:"song-container",children:[(0,N.jsxs)("div",{className:"song-identity",children:[(0,N.jsx)("div",{className:"difficulty-text",children:"Song level"}),(0,N.jsx)("div",{className:"difficulty-value",children:null===ae||void 0===ae?void 0:ae.difficulty})]}),(0,N.jsxs)("div",{className:"song-info",children:[(0,N.jsx)("div",{className:"song-name",children:null===ae||void 0===ae?void 0:ae.title}),(0,N.jsxs)("div",{className:"artist-name",children:["- ",null===ae||void 0===ae?void 0:ae.artist," -"]}),(0,N.jsx)("button",{className:"best-score-btn",children:"Best Score"})]}),(0,N.jsx)("div",{className:"play-button-container",children:(0,N.jsx)("button",{className:"play-button",onClick:async()=>{const e=I[U];if(e)try{await t.A.post(`${P}/api/play`,{songId:e.id}),Q("/TestGame",{state:{songId:e.id}})}catch(s){console.error("Error starting game:",s)}},children:(0,N.jsx)("div",{className:"play-icon-container",children:(0,N.jsx)("span",{className:"play-icon",children:"\u25b6"})})})})]})]})]}),$&&(0,N.jsx)("div",{className:"popup-overlay",children:(0,N.jsxs)("div",{className:"popup-content",children:[(0,N.jsx)("h2",{children:"Confirm Leave"}),(0,N.jsx)("p",{children:"Are you sure you want to leave the game?"}),(0,N.jsx)("button",{className:"stay-button",onClick:()=>{G(!1)},children:"Stay"}),(0,N.jsx)("button",{className:"leave-button",onClick:()=>{window.location.href="/"},children:"Leave"})]})})]}),(0,N.jsx)(r.G9,{unityProvider:V}),!0===z&&(0,N.jsx)("p",{children:`Game Over ${_}! You've scored ${B} points.`})]})}},7653:(e,s,a)=>{e.exports=a.p+"static/media/profile.76341d5d9e6dea6c094b.png"}}]);
//# sourceMappingURL=91.c2ee4d48.chunk.js.map