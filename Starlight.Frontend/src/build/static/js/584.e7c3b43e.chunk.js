"use strict";(self.webpackChunkstarlight=self.webpackChunkstarlight||[]).push([[584],{5203:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var s=a(5043),n=a(6213),r=(a(4166),a(3216)),l=a(5475),o=a(4320),c=a(6494),i=a(9883),d=a(653),h=a(1832),u=a(8440),m=a(4797),p=a(9895),g=a(972),v=a(5164),x=a(3900),y=a(3204),f=a(9148),j=a(579);const b="https://cluster1.swyrin.id.vn";const k=function(){var e,t;const a=(0,r.zy)(),k=(null===(e=a.state)||void 0===e?void 0:e.currentSong)||null,N=(null===(t=a.state)||void 0===t?void 0:t.currentSongIndex)||0,[w,S]=(0,s.useState)(k),[L,E]=(0,s.useState)(N),[C,A]=(0,s.useState)(!1),[$,I]=(0,s.useState)(!1),[z,H]=(0,s.useState)([]),[T,q]=(0,s.useState)(null),[F,U]=(0,s.useState)(null),[_,D]=(0,s.useState)(""),B=new x.A(z,{keys:["title"],threshold:.3}),M=_?B.search(_).map((e=>e.item)):z;(0,s.useEffect)((()=>{S(k),E(N)}),[k,N]),(0,s.useEffect)((()=>{(async()=>{try{const e=(await n.A.get(`${b}/api/track/all`,{headers:{"Content-Type":"application/json"}})).data;H(e),e.length>0&&(E(0),S(e[0]))}catch(e){console.error("Error fetching data:",e)}})()}),[]),(0,s.useEffect)((()=>{L>=z.length&&E(0)}),[L,z.length]);const G=(0,s.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{E((e=>{const t=(e+1)%z.length;return S(z[t]),t})),e.classList.remove("fade-out")}),{once:!0}))}),[z]),K=(0,s.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{E((e=>{const t=(e-1+z.length)%z.length;return S(z[t]),t})),e.classList.remove("fade-out")}),{once:!0}))}),[z]),P=()=>{I(!0)};(0,s.useEffect)((()=>{let e;return w&&w.audioUrl&&(e=new Audio(w.audioUrl),e.loop=!0,e.play().catch((e=>console.error("Error playing audio:",e)))),()=>{e&&(e.pause(),e=null)}}),[w]),(0,s.useEffect)((()=>{const e=document.querySelector(".background-image img");e&&e.addEventListener("transitionend",(()=>{e.classList.remove("morph")}))}),[w]);const W=e=>{const t=document.querySelector(e);t&&(t.classList.add("hover"),setTimeout((()=>{t.classList.remove("hover")}),300))};(0,s.useEffect)((()=>{const e=e=>{39===e.keyCode?(G(),W(".next-btn")):37===e.keyCode&&(K(),W(".prev-btn"))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[G,K]),(0,s.useEffect)((()=>{const e=e=>{27===e.keyCode&&(e.preventDefault(),P())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]);const O=(0,s.useCallback)((async(e,t)=>{const a=document.querySelector(t);if(!a)return void console.error(`Container with selector "${t}" not found.`);a.innerHTML="";const{data:s,isFallback:r}=await(async e=>{try{const t=(await n.A.get(`${b}${e}`)).data;if(Array.isArray(t))return{data:t,isFallback:!1};throw new Error("Invalid API response")}catch(t){console.error("Error fetching heatmap data:",t);const e=[],a=Array.from({length:30},((e,t)=>`Group ${t+1}`)),s=["A","B","C","D","E"];for(let n=0;n<a.length;n++)for(let t=0;t<s.length;t++)e.push({group:a[n],variable:s[t],value:Math.floor(100*Math.random())});return{data:e,isFallback:!0}}})(e),l=50,o=25,c=50,i=50,d=900-i-o,h=300-l-c,u=f.Ltv(a).append("svg").attr("width",d+i+o).attr("height",h+l+c).append("g").attr("transform",`translate(${i},${l})`),m=Array.from(new Set(s.map((e=>e.group)))),p=Array.from(new Set(s.map((e=>e.variable)))),g=f.WH().range([0,d]).domain(m).padding(.2),v=f.WH().range([h,0]).domain(p).padding(.2),x=f.exT().interpolator(f.FbK).domain([0,100]);u.append("g").style("font-size",15).attr("transform",`translate(0,${h})`).call(f.l78(g).tickSize(0)).select(".domain").remove(),u.append("g").style("font-size",15).call(f.V4s(v).tickSize(0)).select(".domain").remove();const y=f.Ltv(a).append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px");u.selectAll().data(s,(e=>`${e.group}:${e.variable}`)).enter().append("rect").attr("x",(e=>g(e.group))).attr("y",(e=>v(e.variable))).attr("rx",4).attr("ry",4).attr("width",g.bandwidth()).attr("height",v.bandwidth()).style("fill",(e=>x(e.value||0))).style("stroke-width",4).style("stroke","none").style("opacity",.8).on("mouseover",(function(e,t){y.style("opacity",1),f.Ltv(this).style("stroke","black").style("opacity",1)})).on("mousemove",(function(e,t){y.html(`Beat Accuracy: ${t.value||0}%`).style("left",`${e.pageX+20}px`).style("top",e.pageY-20+"px")})).on("mouseleave",(function(){y.style("opacity",0),f.Ltv(this).style("stroke","none").style("opacity",.8)})),r&&u.append("text").attr("x",d/2).attr("y",h+c+20).attr("text-anchor","middle").style("font-size","12px").style("fill","red").text("Data fetched from fallback random data")}),[]);return(0,s.useEffect)((()=>{(async()=>{await O("/api/score/recent","#heatmap-container-1")})()}),[O]),(0,s.useEffect)((()=>{(async()=>{await O(`/api/score/${null===w||void 0===w?void 0:w.id}`,"#heatmap-container-2")})()}),[O,w]),(0,j.jsx)("div",{className:"historypage",children:(0,j.jsxs)(s.Suspense,{fallback:(0,j.jsx)("div",{children:"Loading..."}),children:[(0,j.jsxs)("header",{className:"navbar",children:[(0,j.jsxs)("div",{id:"nav-icon1",className:C?"open":"",onClick:()=>{A(!C)},children:[(0,j.jsx)("span",{}),(0,j.jsx)("span",{}),(0,j.jsx)("span",{})]}),(0,j.jsxs)("nav",{className:"nav-links left",children:[(0,j.jsxs)(l.N_,{to:"/songpage",children:[(0,j.jsx)("img",{src:i,alt:"Songs",className:"nav-icon"}),(0,j.jsx)("span",{children:"Songs"})]}),(0,j.jsxs)(l.N_,{to:"/historypage",children:[(0,j.jsx)("img",{src:d,alt:"History",className:"nav-icon"}),(0,j.jsx)("span",{children:"History"})]})]}),(0,j.jsx)("div",{className:"logo-container",children:(0,j.jsx)(l.N_,{to:"/songpage",className:"logo",children:(0,j.jsxs)("span",{className:"star-light",children:[(0,j.jsx)("span",{children:"STAR"}),(0,j.jsx)("img",{src:o,alt:"Logo",className:"logo-icon",style:{verticalAlign:"middle"}}),(0,j.jsx)("span",{className:"light",children:"LIGHT"})]})})}),(0,j.jsxs)("nav",{className:"nav-links right",children:[(0,j.jsxs)(l.N_,{to:"/eventpage",state:{currentSong:w,currentSongIndex:L},children:[(0,j.jsx)("img",{src:h,alt:"Events",className:"nav-icon"}),(0,j.jsx)("span",{children:"Events"})]}),(0,j.jsxs)(l.N_,{to:"/storepage",state:{currentSong:w,currentSongIndex:L},children:[(0,j.jsx)("img",{src:u,alt:"Store",className:"nav-icon"}),(0,j.jsx)("span",{children:"Store"})]})]}),(0,j.jsxs)("div",{className:"sidebar "+(C?"open":""),style:{backgroundImage:`url(${m})`},children:[(0,j.jsx)("div",{className:"search-bar-container",children:(0,j.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault()},children:[(0,j.jsx)("label",{htmlFor:"search",className:"screen-reader-text",children:"Search"}),(0,j.jsx)("input",{type:"search",id:"search",placeholder:"Search songs...",value:_,onChange:e=>{D(e.target.value)},className:"search-field"}),(0,j.jsx)("button",{type:"submit",className:"search-submit",children:(0,j.jsx)(y.KSO,{className:"search-bar-icon"})})]})}),(0,j.jsx)("ul",{children:M.map(((e,t)=>(0,j.jsxs)("li",{className:"song-item",onClick:()=>S(e),children:[(0,j.jsxs)("div",{className:"song-info-sidebar",children:[(0,j.jsx)("img",{src:p,alt:"Song Sidebar Icon",className:"song-sidebar-icon"}),(0,j.jsx)("span",{className:"sidebar-song",children:e.title})]}),(0,j.jsx)("div",{className:"song-bg",style:{backgroundImage:`url(${e.backgroundUrl})`}}),(0,j.jsx)("span",{className:"sidebar-song-title",children:e.title})]},t)))})]}),(0,j.jsx)("div",{className:"leave-button",children:(0,j.jsx)("img",{src:c,alt:"Leave",className:"leave-icon",style:{width:"26px",height:"26px"},onClick:P})})]}),(0,j.jsxs)("div",{className:"content-layer",children:[(0,j.jsx)("div",{className:"background-image",children:(0,j.jsx)("img",{src:w&&w.backgroundUrl?`${w.backgroundUrl}`:"",alt:"Background"})}),(0,j.jsxs)("div",{className:"song-navigation",children:[(0,j.jsx)("button",{className:"nav-btn prev-btn",onClick:K,children:(0,j.jsx)("img",{src:g,alt:"Previous",style:{width:"21px",height:"21px"}})}),(0,j.jsx)("button",{className:"nav-btn next-btn",onClick:G,children:(0,j.jsx)("img",{src:v,alt:"Next",style:{width:"21px",height:"21px"}})})]}),(0,j.jsx)("div",{id:"heatmap-container-1",className:"heatmap-container"}),(0,j.jsx)("div",{id:"heatmap-container-2",className:"heatmap-container"})]}),$&&(0,j.jsx)("div",{className:"popup-overlay",children:(0,j.jsxs)("div",{className:"popup-content",children:[(0,j.jsx)("h2",{children:"Confirm Leave"}),(0,j.jsx)("p",{children:"Are you sure you want to leave the game?"}),(0,j.jsx)("button",{className:"stay-button",onClick:()=>{I(!1)},children:"Stay"}),(0,j.jsx)("button",{className:"leave-button",onClick:()=>{window.location.href="/"},children:"Leave"})]})})]})})}}}]);
//# sourceMappingURL=584.e7c3b43e.chunk.js.map