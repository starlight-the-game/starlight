"use strict";(self.webpackChunkstarlight=self.webpackChunkstarlight||[]).push([[710,829],{2472:(e,s,a)=>{a.r(s),a.d(s,{default:()=>q});var n=a(5043),t=a(6213),l=(a(4166),a(3216)),i=a(5475),r=a(8397),c=a(7653),o=a(4320),d=a(6494),u=a(9883),h=a(653),m=a(1832),x=a(8440),g=a(972),j=a(5164),v=a(4797),p=a(9895),y=a(3900),b=a(3204),N=a(3829),f=a(579);const S=(0,n.lazy)((()=>Promise.all([a.e(339),a.e(508)]).then(a.bind(a,2100)))),k=(0,n.lazy)((()=>Promise.all([a.e(148),a.e(584)]).then(a.bind(a,5203)))),w=(0,n.lazy)((()=>a.e(20).then(a.bind(a,7639)))),E=(0,n.lazy)((()=>a.e(309).then(a.bind(a,4690)))),L=(0,n.lazy)((()=>Promise.all([a.e(339),a.e(148),a.e(508),a.e(353),a.e(584)]).then(a.bind(a,6353)))),P=(0,n.lazy)((()=>Promise.all([a.e(289),a.e(283)]).then(a.bind(a,9283)))),C="https://cluster1.swyrin.id.vn";const q=function e(){const[s,a]=(0,n.useState)(!1),[q,I]=(0,n.useState)({}),[F,T]=(0,n.useState)([]),[U,z]=(0,n.useState)(0),[A,$]=(0,n.useState)(!1),[G,R]=(0,n.useState)(!1),[H,_]=(0,n.useState)(),[O,B]=(0,n.useState)(),[D,K]=(0,n.useState)(""),[M,V]=(0,n.useState)(null),Y=new y.A(F,{keys:["title"],threshold:.3}),Z=D?Y.search(D).map((e=>e.item)):F,{unityProvider:J,sendMessage:Q,addEventListener:W,removeEventListener:X}=(0,r.sT)({loaderUrl:"build/myunityapp.loader.js",dataUrl:"build/myunityapp.data",frameworkUrl:"build/myunityapp.framework.js",codeUrl:"build/myunityapp.wasm"}),ee=(0,l.Zp)(),se=(0,n.useCallback)(((e,s)=>{R(!0),_(e),B(s)}),[]);(0,n.useEffect)((()=>(W("GameOver",se),()=>{X("GameOver",se)})),[W,X,se]),(0,n.useEffect)((()=>{(async()=>{try{const e=await t.A.get(`${C}/api/user`,{headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===e.status){const s=e.data;I({id:s.id||123456,name:s.name||"Sanraku",profilePic:s.avatar||c})}else console.error("Error fetching user data:",e.statusText);const s=await t.A.get(`${C}/api/track/all`,{headers:{"Content-Type":"application/json"}});if(200===s.status){const e=s.data;T(e),e.length>0&&z(0)}else console.error("Error fetching songs data:",s.statusText)}catch(e){console.error("Error fetching data:",e)}})()}),[]);const ae=(0,n.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{z((e=>(e+1)%F.length)),e.classList.remove("fade-out")}),{once:!0}))}),[F]),ne=(0,n.useCallback)((()=>{const e=document.querySelector(".background-image img");e&&(e.classList.add("fade-out"),e.addEventListener("transitionend",(()=>{z((e=>(e-1+F.length)%F.length)),e.classList.remove("fade-out")}),{once:!0}))}),[F]),te=()=>{$(!0)},le=F[U];(0,n.useEffect)((()=>{let e;return le&&le.audioUrl&&(e=new Audio(le.audioUrl),e.loop=!0,e.play().catch((e=>console.error("Error playing audio:",e)))),()=>{e&&(e.pause(),e=null)}}),[le]),(0,n.useEffect)((()=>{const e=document.querySelector(".background-image img");e&&e.addEventListener("transitionend",(()=>{e.classList.remove("morph")}))}),[le]);const ie=e=>{const s=document.querySelector(e);s&&(s.classList.add("hover"),setTimeout((()=>{s.classList.remove("hover")}),300))};return(0,n.useEffect)((()=>{const e=e=>{39===e.keyCode?(ae(),ie(".next-btn")):37===e.keyCode&&(ne(),ie(".prev-btn"))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[ae,ne]),(0,n.useEffect)((()=>{const e=e=>{27===e.keyCode&&(e.preventDefault(),te())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]),(0,f.jsxs)(n.Fragment,{children:[(0,f.jsx)(n.Suspense,{fallback:(0,f.jsx)("div",{children:"Loading..."}),children:(0,f.jsxs)(l.BV,{children:[(0,f.jsx)(l.qh,{path:"/SongPage",element:(0,f.jsx)(e,{})}),(0,f.jsx)(l.qh,{path:"/HistoryPage",element:(0,f.jsx)(k,{})}),(0,f.jsx)(l.qh,{path:"/EventPage",element:(0,f.jsx)(w,{})}),(0,f.jsx)(l.qh,{path:"/StorePage",element:(0,f.jsx)(E,{})}),(0,f.jsx)(l.qh,{path:"/Logout",element:(0,f.jsx)(S,{})}),(0,f.jsx)(l.qh,{path:"/ProfilePage",element:(0,f.jsx)(L,{})}),(0,f.jsx)(l.qh,{path:"/TestGame",element:(0,f.jsx)(P,{songId:null===le||void 0===le?void 0:le.id})})]})}),(0,f.jsxs)("div",{className:"songpage",children:[(0,f.jsxs)("header",{className:"navbar",children:[(0,f.jsxs)("div",{id:"nav-icon1",className:s?"open":"",onClick:()=>{a(!s)},children:[(0,f.jsx)("span",{}),(0,f.jsx)("span",{}),(0,f.jsx)("span",{})]}),(0,f.jsxs)("nav",{className:"nav-links left",children:[(0,f.jsxs)(i.N_,{to:"/SongPage",children:[(0,f.jsx)("img",{src:u,alt:"Songs",className:"nav-icon"}),(0,f.jsx)("span",{children:"Songs"})]}),(0,f.jsxs)(i.N_,{to:"/HistoryPage",state:{currentSong:le,currentSongIndex:U},children:[(0,f.jsx)("img",{src:h,alt:"History",className:"nav-icon"}),(0,f.jsx)("span",{children:"History"})]})]}),(0,f.jsx)("div",{className:"logo-container",children:(0,f.jsx)("a",{href:"/SongPage",className:"logo",children:(0,f.jsxs)("span",{className:"star-light",children:[(0,f.jsx)("span",{children:"STAR"}),(0,f.jsx)("img",{src:o,alt:"Logo",className:"logo-icon",style:{verticalAlign:"middle"}}),(0,f.jsx)("span",{className:"light",children:"LIGHT"})]})})}),(0,f.jsxs)("nav",{className:"nav-links right",children:[(0,f.jsxs)(i.N_,{to:"/EventPage",state:{currentSong:le,currentSongIndex:U},children:[(0,f.jsx)("img",{src:m,alt:"Events",className:"nav-icon"}),(0,f.jsx)("span",{children:"Events"})]}),(0,f.jsxs)(i.N_,{to:"/StorePage",state:{currentSong:le,currentSongIndex:U},children:[(0,f.jsx)("img",{src:x,alt:"Store",className:"nav-icon"}),(0,f.jsx)("span",{children:"Store"})]})]}),(0,f.jsxs)("div",{className:"sidebar "+(s?"open":""),style:{backgroundImage:`url(${v})`},children:[(0,f.jsx)("div",{className:"search-bar-container",children:(0,f.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault()},children:[(0,f.jsx)("label",{htmlFor:"search",className:"screen-reader-text",children:"Search"}),(0,f.jsx)("input",{type:"search",id:"search",placeholder:"Search songs...",value:D,onChange:e=>{K(e.target.value)},className:"search-field"}),(0,f.jsx)("button",{type:"submit",className:"search-submit",children:(0,f.jsx)(b.KSO,{className:"search-bar-icon"})})]})}),(0,f.jsx)("ul",{children:Z.map(((e,s)=>(0,f.jsxs)("li",{className:"song-item",onClick:()=>(e=>{const s=F.findIndex((s=>s.id===e.id));-1!==s&&z(s)})(e),children:[(0,f.jsxs)("div",{className:"song-info-sidebar",children:[(0,f.jsx)("img",{src:p,alt:"Song Sidebar Icon",className:"song-sidebar-icon"}),(0,f.jsx)("span",{className:"sidebar-song",children:e.title})]}),(0,f.jsx)("div",{className:"song-bg",style:{backgroundImage:`url(${e.backgroundUrl})`}}),(0,f.jsx)("span",{className:"sidebar-song-title",children:e.title})]},s)))})]}),(0,f.jsx)("div",{className:"leave-button",children:(0,f.jsx)("img",{src:d,alt:"Leave",className:"leave-icon",style:{width:"26p</button>x",height:"26px"},onClick:te})})]}),(0,f.jsxs)("div",{className:"content-layer",children:[(0,f.jsx)("div",{className:"background-image",children:(0,f.jsx)("img",{src:le&&le.backgroundUrl?`${le.backgroundUrl}`:"",alt:"Background"})}),(0,f.jsxs)("div",{className:"song-content",children:[(0,f.jsx)("div",{className:"user-profile",children:(0,f.jsx)("table",{children:(0,f.jsxs)("tr",{children:[(0,f.jsxs)("td",{children:[(0,f.jsx)("div",{className:"user-name",children:q.name}),(0,f.jsxs)("div",{className:"user-id",children:["ID: ",q.id]})]}),(0,f.jsx)("td",{children:(0,f.jsx)(i.N_,{to:"/ProfilePage",children:(0,f.jsx)("img",{src:q.profilePic||c,alt:"Profile",className:"profile-img"})})})]})})}),(0,f.jsxs)("div",{className:"song-navigation",children:[(0,f.jsx)("button",{className:"nav-btn prev-btn",onClick:ne,children:(0,f.jsx)("img",{src:g,alt:"Previous",style:{width:"21px",height:"21px"}})}),(0,f.jsx)("button",{className:"nav-btn next-btn",onClick:ae,children:(0,f.jsx)("img",{src:j,alt:"Next",style:{width:"21px",height:"21px"}})})]}),(0,f.jsxs)("div",{className:"song-container",children:[(0,f.jsxs)("div",{className:"song-identity",children:[(0,f.jsx)("div",{className:"difficulty-text",children:"Song level"}),(0,f.jsx)("div",{className:"difficulty-value",children:null===le||void 0===le?void 0:le.difficulty})]}),(0,f.jsxs)("div",{className:"song-info",children:[(0,f.jsx)("div",{className:"song-name",children:null===le||void 0===le?void 0:le.title}),(0,f.jsxs)("div",{className:"artist-name",children:["- ",null===le||void 0===le?void 0:le.artist," -"]}),(0,f.jsx)("div",{className:"best-score",children:"Best Score"})]}),(0,f.jsx)("div",{className:"play-button-container",children:(0,f.jsx)("button",{className:"play-button",onClick:async()=>{const e=F[U];if(e)try{await t.A.post(`${C}/api/game/start`,{songId:e.id},{withCredentials:!0}),(0,N.t)(),ee("/TestGame",{state:{songId:e.id}})}catch(s){console.error("Error starting game:",s)}},children:(0,f.jsx)("div",{className:"play-icon-container",children:(0,f.jsx)("span",{className:"play-icon",children:"\u25b6"})})})})]})]})]}),A&&(0,f.jsx)("div",{className:"popup-overlay",children:(0,f.jsxs)("div",{className:"popup-content",children:[(0,f.jsx)("h2",{children:"Confirm Leave"}),(0,f.jsx)("p",{children:"Are you sure you want to leave the game?"}),(0,f.jsx)("button",{className:"stay-button",onClick:()=>{$(!1)},children:"Stay"}),(0,f.jsx)("button",{className:"leave-button",onClick:()=>{window.location.href="/"},children:"Leave"})]})})]}),(0,f.jsx)(r.G9,{unityProvider:J}),!0===G&&(0,f.jsx)("p",{children:`Game Over ${H}! You've scored ${O} points.`})]})}},3829:(e,s,a)=>{a.d(s,{t:()=>n});const n=()=>{const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},7653:(e,s,a)=>{e.exports=a.p+"static/media/profile.76341d5d9e6dea6c094b.png"}}]);
//# sourceMappingURL=710.bbf8c882.chunk.js.map